{"info":{"author":"","author_email":"Richard Kiss <him@richardkiss.com>","bugtrack_url":null,"classifiers":[],"description":"# Runtime Builder\n\nSometimes python developers want to include compiled output or other binary blob artifacts in their wheels. The source materials for this output is checked into git, but the blobs are not, since they're not source material and are at risk getting out of sync with the source distribution.\n\nWhen building the wheel, the blobs need to be generated. But it may also be nice to rebuild the blobs if the source have changed at runtime to automate a step of the edit/test cycle.\n\nThis project lets you declare a single configuration describing how to build the artifacts, and build them at runtime during the development cycle or at wheel build time.\n\n## Example\n\nThere are example projects in `tests/project_template_enscons` and `tests/project_template_setuptools`.\n\n```\ntests/project_template_setuptools\n├── README.md\n├── proj\n│   ├── bar.source\n│   ├── foo.source\n│   ├── run_test.py\n│   └── runtime_build\n├── pyproject.toml.template\n├── setup.py\n├── test_pip_install.sh\n└── test_pip_install_editable.sh\n```\n\nThis examples uses `setuptools` and `setup.py` to build. The `setup.py` and `runtime_build` files work together to make available artifacts built from the `.source` files.\n\n```\nproject_template_enscons\n├── README.md\n├── SConstruct\n├── proj\n│   ├── bar.source\n│   ├── foo.source\n│   ├── run_test.py\n│   └── runtime_build\n├── pyproject.toml.template\n├── test_pip_install.sh\n└── test_pip_install_editable.sh\n```\n\nNote that this example uses `enscons` to build, as `setuptools` does not easily allow fine-grained control of the contents of the `sdist` and `wheel` files. In particular, this example takes pains to include the source files `runtime_build`, `foo.source` and `bar.source` in the sdist but not the wheel.\n\n\n### Configuration\n\nArtifacts to be build must be declared in a `runtime_build` file located in the destination module of the artifacts. Each submodule can have zero or one of these build files. In the `project_template` example above, `bar.source` and `foo.source` each produce an output in the `proj` submodule, and `runtime_build` defines what the artifacts are.\n\nThis configuration file can be loaded at build time or at run time, so it *cannot* import anything that isn't made available in the `build-system.requires` section of `pyproject.toml`. In particular, it cannot import anything from the project being built since it has to be built before it can be installed in the build package, leading to a bootstrap problem.\n\nHere is the example from above:\n\n```python\nfrom pathlib import Path\nfrom typing import Callable\n\n\nclass MultiplyBuild:\n    def __init__(self, factor: int) -> None:\n        self.factor = factor\n\n    def __call__(self, target_path: Path):\n        source_path = target_path.with_suffix(\".source\")\n        t = int(open(source_path).read())\n        with open(target_path, \"w\") as f:\n            f.write(f\"{t * self.factor}\")\n\n\ndef count_build(target_path: Path) -> None:\n    source_path = target_path.with_suffix(\".source\")\n    t = open(source_path).read()\n    with open(target_path, \"w\") as f:\n        f.write(f\"{len(t)}\\n\")\n\n\nBUILD_ARGUMENTS: dict[str, Callable[[Path], None]] = {\n    \"foo.val\": MultiplyBuild(50),\n    \"bar.count\": count_build,\n}\n```\n\nThe key is to return a `dict` object called `BUILD_ARGUMENTS` that has `str` keys corresponding to artifacts, and `Callable` values. The `Callable` should generate the given artifact.\n\nThese examples could potentially build the artifacts every time they are referenced. If a build takes long enough, you may want to add code to only build when necessary to speed the edit/test cycle.\n\n### Build-time\n\nThe `runtime_builder` wheel is primarily a build-time dependency. If you want to take advantage of the run-time building, you need to install it in your runtime virtual environment. However, it generally should not be installed in the release version of your package.\n\nAdd it to your `pyproject.toml` file:\n\n```toml\n[build-system]\nrequires = [\"runtime_builder\", ...]\n```\n\nIn the `SConstruct` file is the following line:\n\n`built_items = build_all_items_for_package(\"proj\")`\n\nThis returns the list of artifacts as a list of `Path` objects. These files must be included in the final wheel.\n\n### Runtime\n\nTo use the dynamic build capabilities at runtime, use something like this boilerplate function:\n\n```python\ntry:\n    from runtime_builder import build_on_demand\nexcept ImportError:\n    # `runtime_builder` is an optional dependency for development only\n    def build_on_demand(*args):\n        pass\n\n\ndef load_resource(\n    resource_path: str,\n    package: Package,\n) -> bytes:\n    build_on_demand(package, resource_path)\n    with as_file(files(package).joinpath(resource_path)) as target_path:\n        return target_path.read_bytes()\n```\n\nThis checks for presence of `runtime_builder`, and invokes it if available before accessing the resource.\n","description_content_type":"text/markdown","docs_url":null,"download_url":"","downloads":{"last_day":-1,"last_month":-1,"last_week":-1},"dynamic":null,"home_page":"","keywords":"","license":"Copyright 2023 by Richard Kiss  Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License. You may obtain a copy of the License at  http://www.apache.org/licenses/LICENSE-2.0  Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. ","license_expression":null,"license_files":null,"maintainer":"","maintainer_email":"","name":"runtime-builder","package_url":"https://pypi.org/project/runtime-builder/","platform":null,"project_url":"https://pypi.org/project/runtime-builder/","project_urls":null,"provides_extra":null,"release_url":"https://pypi.org/project/runtime-builder/0.1.5/","requires_dist":["importlib_resources>=6.1.1"],"requires_python":"","summary":"Allow automatic builds in edit mode","version":"0.1.5","yanked":false,"yanked_reason":null},"last_serial":21503723,"releases":{"0.1.0":[{"comment_text":null,"digests":{"blake2b_256":"5ec5ba6125c854a09a1121feb60880facf59d6b9f6726fb16d353215b951d439","md5":"144809d6c8c907b726be272f740a7c80","sha256":"9662cc0956dfe92079b215fa9e28260a1f04dc84ec48b2e03d15e9fd54fdd8ff"},"downloads":-1,"filename":"runtime_builder-0.1.0.tar.gz","has_sig":false,"md5_digest":"144809d6c8c907b726be272f740a7c80","packagetype":"sdist","python_version":"source","requires_python":null,"size":6376,"upload_time":"2023-07-19T23:45:34","upload_time_iso_8601":"2023-07-19T23:45:34.323510Z","url":"https://files.pythonhosted.org/packages/5e/c5/ba6125c854a09a1121feb60880facf59d6b9f6726fb16d353215b951d439/runtime_builder-0.1.0.tar.gz","yanked":false,"yanked_reason":null}],"0.1.1":[{"comment_text":null,"digests":{"blake2b_256":"ad177a86a14666527a3226475fc1c9acace3ccfc778de9461657153bfad7cfd5","md5":"fd5484ee9c6d0a1aa607a976d622e43a","sha256":"a4b938ffc9ca55a6d8142e77b9c46dd8bc2e2124f3568feed26eb3d824965b20"},"downloads":-1,"filename":"runtime_builder-0.1.1.tar.gz","has_sig":false,"md5_digest":"fd5484ee9c6d0a1aa607a976d622e43a","packagetype":"sdist","python_version":"source","requires_python":null,"size":7752,"upload_time":"2023-07-27T05:46:55","upload_time_iso_8601":"2023-07-27T05:46:55.877947Z","url":"https://files.pythonhosted.org/packages/ad/17/7a86a14666527a3226475fc1c9acace3ccfc778de9461657153bfad7cfd5/runtime_builder-0.1.1.tar.gz","yanked":false,"yanked_reason":null}],"0.1.2":[{"comment_text":"","digests":{"blake2b_256":"5094d1a0315694e07940d46bef9bc2dbcacb19c0bb3a0d16927dfadf3a8cd8f7","md5":"fb7e2b734c5b76dd5a451112f850dcfd","sha256":"f0e5980e1211600a12ce0e1e94d77c2ef2d110c99f7ca857c4419f3c5dc8d735"},"downloads":-1,"filename":"runtime_builder-0.1.2.tar.gz","has_sig":false,"md5_digest":"fb7e2b734c5b76dd5a451112f850dcfd","packagetype":"sdist","python_version":"source","requires_python":null,"size":5091,"upload_time":"2023-11-10T01:55:30","upload_time_iso_8601":"2023-11-10T01:55:30.989607Z","url":"https://files.pythonhosted.org/packages/50/94/d1a0315694e07940d46bef9bc2dbcacb19c0bb3a0d16927dfadf3a8cd8f7/runtime_builder-0.1.2.tar.gz","yanked":false,"yanked_reason":null}],"0.1.3":[{"comment_text":"","digests":{"blake2b_256":"c1f0f3d116691c0289c0dea6e4a03ef0ce62cbe907aaf1dd82112da42d4c4280","md5":"090669729a645b1362e810a51db00dcc","sha256":"55fbfca2154221a747f983fb81886ccc70be40006b8cf3c0387525096ddc4add"},"downloads":-1,"filename":"runtime_builder-0.1.3.tar.gz","has_sig":false,"md5_digest":"090669729a645b1362e810a51db00dcc","packagetype":"sdist","python_version":"source","requires_python":null,"size":5153,"upload_time":"2024-01-03T23:32:57","upload_time_iso_8601":"2024-01-03T23:32:57.910042Z","url":"https://files.pythonhosted.org/packages/c1/f0/f3d116691c0289c0dea6e4a03ef0ce62cbe907aaf1dd82112da42d4c4280/runtime_builder-0.1.3.tar.gz","yanked":false,"yanked_reason":null}],"0.1.4":[{"comment_text":"","digests":{"blake2b_256":"0a5c89da474dc0c4cee114325fadbf20163be65168a304642d980ed6cce8aa36","md5":"7ce9a78776695a2517c4d064d4d67ebb","sha256":"e9299b7e94efc5eaf4cafb1c347098d4177fea6152d7b4b0c4461e358c79b5b1"},"downloads":-1,"filename":"runtime_builder-0.1.4.tar.gz","has_sig":false,"md5_digest":"7ce9a78776695a2517c4d064d4d67ebb","packagetype":"sdist","python_version":"source","requires_python":null,"size":5535,"upload_time":"2024-01-17T01:49:56","upload_time_iso_8601":"2024-01-17T01:49:56.464384Z","url":"https://files.pythonhosted.org/packages/0a/5c/89da474dc0c4cee114325fadbf20163be65168a304642d980ed6cce8aa36/runtime_builder-0.1.4.tar.gz","yanked":false,"yanked_reason":null}],"0.1.5":[{"comment_text":"","digests":{"blake2b_256":"e1c7c4d888e45750ced04ffcad3ae09afba794c28bf662eb0061decef2dd5583","md5":"a221f37a3f0ac3ac1330c5bb17ca6659","sha256":"c94256fc7112d4a392d7eadd701c490328d82ef308ee7807bd203b9cd58b3a1d"},"downloads":-1,"filename":"runtime_builder-0.1.5.tar.gz","has_sig":false,"md5_digest":"a221f37a3f0ac3ac1330c5bb17ca6659","packagetype":"sdist","python_version":"source","requires_python":null,"size":5541,"upload_time":"2024-01-20T00:01:56","upload_time_iso_8601":"2024-01-20T00:01:56.331784Z","url":"https://files.pythonhosted.org/packages/e1/c7/c4d888e45750ced04ffcad3ae09afba794c28bf662eb0061decef2dd5583/runtime_builder-0.1.5.tar.gz","yanked":false,"yanked_reason":null}]},"urls":[{"comment_text":"","digests":{"blake2b_256":"e1c7c4d888e45750ced04ffcad3ae09afba794c28bf662eb0061decef2dd5583","md5":"a221f37a3f0ac3ac1330c5bb17ca6659","sha256":"c94256fc7112d4a392d7eadd701c490328d82ef308ee7807bd203b9cd58b3a1d"},"downloads":-1,"filename":"runtime_builder-0.1.5.tar.gz","has_sig":false,"md5_digest":"a221f37a3f0ac3ac1330c5bb17ca6659","packagetype":"sdist","python_version":"source","requires_python":null,"size":5541,"upload_time":"2024-01-20T00:01:56","upload_time_iso_8601":"2024-01-20T00:01:56.331784Z","url":"https://files.pythonhosted.org/packages/e1/c7/c4d888e45750ced04ffcad3ae09afba794c28bf662eb0061decef2dd5583/runtime_builder-0.1.5.tar.gz","yanked":false,"yanked_reason":null}],"vulnerabilities":[]}
